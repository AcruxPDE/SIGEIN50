-- =============================================
-- Proyecto: Sigein 5.0
-- Copyright (c) - Acrux - 2016
-- Author: GABRIEL VAZQUEZ
-- CREATE date: 21/01/2016
-- Description: Obtiene los datos de las competencias genericas del puesto
-- =============================================
CREATE PROCEDURE IDP.SPE_REP_RESULT_PUESTO_COMPETENCIAS_GENERICAS

	@PIN_ID_PUESTO AS INT

AS
BEGIN

	SELECT
		cc.ID_COMPETENCIA,
		cc.CL_COMPETENCIA,
		cc.NB_COMPETENCIA,
		cc.DS_COMPETENCIA,
		ISNULL(cpc.ID_PUESTO_FUNCION,0) AS ID_PUESTO_FUNCION,
		ISNULL(cpc.ID_PUESTO_COMPETENCIA,0) AS ID_PUESTO_COMPETENCIA,
		cc.CL_TIPO_COMPETENCIA AS CL_TIPO_COMPETENCIA,
		ISNULL(cpc.CL_TIPO_COMPETENCIA,'N/A') AS CL_PUESTO_TIPO_COMPETENCIA,
		tp.NB_TIPO_COMPETENCIA AS NB_TIPO_COMPETENCIA,
		cc.CL_CLASIFICACION AS CL_CLASIFICACION,
		CAST(ISNULL(cpc.ID_NIVEL_DESEADO,0) AS INT) AS ID_NIVEL_DESEADO,
		CAST(ISNULL(cpc.NO_VALOR_NIVEL,5) AS INT) AS NO_VALOR_NIVEL
	FROM ADM.C_COMPETENCIA cc
		INNER JOIN ADM.S_TIPO_COMPETENCIA tp on cc.CL_TIPO_COMPETENCIA = tp.CL_TIPO_COMPETENCIA
		INNER JOIN (
					SELECT pc.ID_NIVEL_DESEADO, cn.NO_VALOR_NIVEL, pc.ID_COMPETENCIA, pc.CL_TIPO_COMPETENCIA, pc.ID_PUESTO_FUNCION, pc.ID_PUESTO_COMPETENCIA
					FROM ADM.C_PUESTO_COMPETENCIA pc
						LEFT JOIN ADM.C_COMPETENCIA_NIVEL cn ON PC.ID_NIVEL_DESEADO = cn.ID_NIVEL_COMPETENCIA
					WHERE pc.ID_PUESTO = @PIN_ID_PUESTO) cpc ON cc.ID_COMPETENCIA = cpc.ID_COMPETENCIA
	WHERE cc.FG_ACTIVO = 1 AND tp.FG_ACTIVO = 1 AND cc.CL_TIPO_COMPETENCIA = 'GEN'

END